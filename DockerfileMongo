FROM mongo

COPY db_seed /opt
COPY .env /opt/.env

RUN cp /etc/mongod.conf.orig /etc/mongod.conf && \
    sed -i 's/bindIp: 127.0.0.1/bindIp: 0.0.0.0/' /etc/mongod.conf && \
    cat /etc/mongod.conf && \
    cat /opt/.env

# Check FLASK_ENV before deciding whether to run mongod
CMD ["sh", "-c", "if [ \"$FLASK_ENV\" = \"delivery\" ]; then tail -f /dev/null; else mongod --config /etc/mongod.conf; fi"]